
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "exercise_gallery/exercise_b/compute.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_exercise_gallery_exercise_b_compute.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_exercise_gallery_exercise_b_compute.py:


Polar BVP - Data Generation
============================

Data stored in tidy dataframes:

1. convergence.parquet: Nr, Linf_err
2. solution.parquet: r, phi, u, u_exact, pointwise_err, Nr, r1, r2, L2_err, Linf_err

Each row in ex_b_solution.parquet represents one grid point (r, phi).

.. GENERATED FROM PYTHON SOURCE LINES 14-21

.. code-block:: Python

    from pathlib import Path

    import numpy as np
    import pandas as pd

    from spectral.bvp import solve_polar_bvp


.. GENERATED FROM PYTHON SOURCE LINES 22-25

.. code-block:: Python

    data_dir = Path("data/A2/ex_b")
    data_dir.mkdir(parents=True, exist_ok=True)


.. GENERATED FROM PYTHON SOURCE LINES 26-38

.. code-block:: Python

    print("Running convergence study...")
    Nrs = np.arange(10, 50, step=2)
    errors = np.zeros(Nrs.shape[0])

    r1 = 1
    r2 = 10

    for i, Nr in enumerate(Nrs):
        Phi, Phi_hat, Rs, Theta = solve_polar_bvp(r1, r2, Nr)
        errors[i] = np.max(np.abs(Phi - Phi_hat))
        print(f"  Nr={Nr}: max error = {errors[i]:.6e}")


.. GENERATED FROM PYTHON SOURCE LINES 39-43

.. code-block:: Python

    convergence_df = pd.DataFrame({"Nr": Nrs, "Linf_err": errors})
    convergence_df.to_parquet(data_dir / "convergence.parquet", index=False)
    print(f"Saved convergence data: {data_dir}/convergence.parquet")


.. GENERATED FROM PYTHON SOURCE LINES 44-53

.. code-block:: Python

    print("\nSolving BVP for visualization...")
    r1 = 1
    r2 = 3
    Nr = 20
    Phi, Phi_hat, Rs, Theta = solve_polar_bvp(r1, r2, Nr)

    print(f"  Solution shape: {Phi.shape}")
    print(f"  Max error: {np.max(np.abs(Phi - Phi_hat)):.6e}")


.. GENERATED FROM PYTHON SOURCE LINES 54-55

Flatten 2D grids into long-form data (one row per grid point)

.. GENERATED FROM PYTHON SOURCE LINES 55-83

.. code-block:: Python

    pointwise_err = np.abs(Phi_hat - Phi)
    dx = np.diff(Rs[0, :])
    dx = np.append(dx, dx[-1])
    dy = np.diff(Theta[:, 0])
    dy = np.append(dy, dy[-1])

    # Compute global errors (approximate L2 using grid integration)
    dA = np.outer(dy, dx * Rs[0, :])  # Area element in polar coords: r*dr*dÎ¸
    L2_err = np.sqrt(np.sum(pointwise_err**2 * dA))
    Linf_err = np.max(pointwise_err)

    solution_df = pd.DataFrame(
        {
            "r": Rs.flatten(),
            "phi": Theta.flatten(),
            "u": Phi_hat.flatten(),
            "u_exact": Phi.flatten(),
            "pointwise_err": pointwise_err.flatten(),
            "Nr": Nr,
            "r1": r1,
            "r2": r2,
            "L2_err": L2_err,
            "Linf_err": Linf_err,
        }
    )

    solution_df.to_parquet(data_dir / "solution.parquet", index=False)
    print(f"Saved solution data: {data_dir}/solution.parquet")


.. _sphx_glr_download_exercise_gallery_exercise_b_compute.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: compute.ipynb <compute.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: compute.py <compute.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: compute.zip <compute.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
