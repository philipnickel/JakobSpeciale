
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "exercise_gallery/exercise_f/plot_solution.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_exercise_gallery_exercise_f_plot_solution.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_exercise_gallery_exercise_f_plot_solution.py:


Space-Time Visualization for Two-Soliton Collision
===================================================

Creates space-time visualization showing the full evolution of the two-soliton
collision in the KdV equation.

.. GENERATED FROM PYTHON SOURCE LINES 10-13

Imports
-------
We start by importing the necessary libraries and utility functions.

.. GENERATED FROM PYTHON SOURCE LINES 13-22

.. code-block:: Python


    import numpy as np
    import pandas as pd
    import matplotlib.pyplot as plt

    from spectral.utils.plotting import add_parameter_footer, get_repo_root
    from spectral.utils.io import ensure_output_dir
    from spectral.utils.formatting import extract_metadata, format_dt_latex








.. GENERATED FROM PYTHON SOURCE LINES 23-27

Load simulation data
--------------------
Load the two-soliton collision dataset generated by ``compute.py``.
This contains the solution ``u(x,t)`` at regularly saved time snapshots.

.. GENERATED FROM PYTHON SOURCE LINES 27-39

.. code-block:: Python


    repo_root = get_repo_root()
    data_dir = repo_root / "data/A2/ex_f"
    save_dir = ensure_output_dir(repo_root / "figures/A2/ex_f")

    print("=" * 60)
    print("Exercise f – two-soliton collision (space-time plot)")
    print("=" * 60)

    df = pd.read_parquet(data_dir / "kdv_two_soliton.parquet")
    print(f"Data shape: {df.shape}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ============================================================
    Exercise f – two-soliton collision (space-time plot)
    ============================================================
    Data shape: (156672, 12)




.. GENERATED FROM PYTHON SOURCE LINES 40-44

Extract metadata
----------------
The dataset contains simulation parameters like grid spacing, time step,
and soliton speeds that we'll need for the plot annotations.

.. GENERATED FROM PYTHON SOURCE LINES 44-53

.. code-block:: Python


    metadata = extract_metadata(
        df, ["dx", "dt", "N", "L", "save_every", "c1", "x01", "c2", "x02"]
    )

    print("Metadata:")
    for key, val in metadata.items():
        print(f"  {key} = {val}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Metadata:
      dx = 0.3125
      dt = 0.001967214541458649
      N = 512
      L = 80.0
      save_every = 200
      c1 = 0.5
      x01 = -40.0
      c2 = 0.25
      x02 = -15.0




.. GENERATED FROM PYTHON SOURCE LINES 54-59

Reshape to grid
---------------
The data is stored in tidy format. For visualization, we need to reshape it
into a 2D grid (x, t). We also downsample to reduce the file size while
keeping endpoints for accuracy.

.. GENERATED FROM PYTHON SOURCE LINES 59-89

.. code-block:: Python


    x_vals = np.sort(df["x"].unique())
    t_vals = np.sort(df["t"].unique())

    print(f"Unique x count: {len(x_vals)}, unique t count: {len(t_vals)}")


    def _select_indices(n: int, max_points: int) -> np.ndarray:
        """Return indices that downsample to at most max_points while keeping endpoints."""
        if max_points <= 0 or n <= max_points:
            return np.arange(n, dtype=int)
        stride = int(np.ceil(n / max_points))
        idx = np.arange(0, n, stride, dtype=int)
        if idx[-1] != n - 1:
            idx = np.append(idx, n - 1)
        return idx


    max_x_points = 400
    max_t_points = 800

    idx_x = _select_indices(len(x_vals), max_x_points)
    idx_t = _select_indices(len(t_vals), max_t_points)

    df_matrix = df.pivot(index="x", columns="t", values="u")
    df_matrix = df_matrix.reindex(index=x_vals, columns=t_vals)
    df_down = df_matrix.iloc[idx_x, idx_t]
    x_plot = df_down.index.to_numpy()
    t_plot = df_down.columns.to_numpy()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Unique x count: 512, unique t count: 306




.. GENERATED FROM PYTHON SOURCE LINES 90-95

Create space-time plot
----------------------
Visualize the full space-time evolution as a heatmap. The collision of the
two solitons is clearly visible, as well as the characteristic phase shift
that occurs during the interaction.

.. GENERATED FROM PYTHON SOURCE LINES 95-125

.. code-block:: Python


    fig, ax = plt.subplots()
    im = ax.matshow(
        df_down.values,
        aspect="auto",
    )
    fig.colorbar(im, ax=ax, label=r"$u(x, t)$")

    ax.set_xlabel(r"Time $t$")
    ax.set_ylabel(r"Position $x$")
    ax.set_title("KdV two-soliton collision")

    # Add parameter footer
    N = metadata.get("N", "?")
    L = metadata.get("L", "?")
    dt = metadata.get("dt", "?")
    c1 = metadata.get("c1", "?")
    c2 = metadata.get("c2", "?")
    dt_latex = format_dt_latex(dt)
    add_parameter_footer(
        fig, rf"$N = {N}$, $L = {L}$, $\Delta t = {dt_latex}$, $c_1 = {c1}$, $c_2 = {c2}$"
    )

    output_path = save_dir / "spacetime.pdf"
    fig.savefig(output_path, bbox_inches="tight")
    print(f"Saved space-time plot → {output_path}")

    print("=" * 60)
    print("Plotting complete.")
    print("=" * 60)



.. image-sg:: /exercise_gallery/exercise_f/images/sphx_glr_plot_solution_001.png
   :alt: KdV two-soliton collision
   :srcset: /exercise_gallery/exercise_f/images/sphx_glr_plot_solution_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Saved space-time plot → /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_f/spacetime.pdf
    ============================================================
    Plotting complete.
    ============================================================





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.141 seconds)


.. _sphx_glr_download_exercise_gallery_exercise_f_plot_solution.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_solution.ipynb <plot_solution.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_solution.py <plot_solution.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_solution.zip <plot_solution.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
