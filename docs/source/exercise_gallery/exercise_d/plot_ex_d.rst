
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "exercise_gallery/exercise_d/plot_ex_d.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_exercise_gallery_exercise_d_plot_ex_d.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_exercise_gallery_exercise_d_plot_ex_d.py:


Single Soliton Error and Conservation Analysis
===============================================

Creates 6 plots per method (12 total):

1. Domain investigation - errors
2. Domain investigation - conservation (relative errors)
3. Domain investigation - quantities (actual M, V, E)
4. Node investigation - errors
5. Node investigation - conservation (relative errors)
6. Node investigation - quantities (actual M, V, E)

Each plot uses FacetGrid with c in columns and parameter (L or N) in rows.

.. GENERATED FROM PYTHON SOURCE LINES 18-20

Single soliton diagnostics
Analyze errors and conservation properties for single soliton solutions.

.. GENERATED FROM PYTHON SOURCE LINES 20-31

.. code-block:: Python


    import pandas as pd
    import seaborn as sns

    from spectral.utils.plotting import add_parameter_footer, get_repo_root

    repo_root = get_repo_root()
    data_dir = repo_root / "data/A2/ex_d"
    save_dir = repo_root / "figures/A2/ex_d"
    save_dir.mkdir(parents=True, exist_ok=True)








.. GENERATED FROM PYTHON SOURCE LINES 32-44

.. code-block:: Python

    print("Loading exercise d) data...")
    df_domain_errors = pd.read_parquet(data_dir / "domain_errors.parquet")
    df_domain_quantities = pd.read_parquet(data_dir / "domain_quantities.parquet")
    df_nodes_errors = pd.read_parquet(data_dir / "nodes_errors.parquet")
    df_nodes_quantities = pd.read_parquet(data_dir / "nodes_quantities.parquet")

    print(f"  Domain errors: {df_domain_errors.shape}")
    print(f"  Domain quantities: {df_domain_quantities.shape}")
    print(f"  Nodes errors: {df_nodes_errors.shape}")
    print(f"  Nodes quantities: {df_nodes_quantities.shape}")






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Loading exercise d) data...
      Domain errors: (31430, 9)
      Domain quantities: (47145, 10)
      Nodes errors: (7238, 9)
      Nodes quantities: (10857, 10)




.. GENERATED FROM PYTHON SOURCE LINES 45-196

.. code-block:: Python

    def plot_errors(df_errors, method, investigation_type, param_name):
        """Create error plot using FacetGrid.

        Parameters
        ----------
        df_errors : DataFrame
            Error data (already in long format)
        method : str
            Method name (RK4, RK3)
        investigation_type : str
            'domain' or 'nodes'
        param_name : str
            'L' for domain, 'N' for nodes
        """
        # Filter for this method
        df_err = df_errors[df_errors["method"] == method].copy()

        # Map error_type to display names
        df_err["error_type"] = df_err["error_type"].map(
            {"l2": r"$L^2$ error", "linf": r"$L^\infty$ error"}
        )

        # Create relplot with param_name in rows, c in columns
        g = sns.relplot(
            data=df_err,
            x="t",
            y="error",
            hue="error_type",
            row=param_name,
            col="c",
            kind="line",
            height=3.5,
            aspect=1.3,
            facet_kws={"sharex": True, "sharey": False},
        )

        # Set log scale for y-axis
        for ax in g.axes.flat:
            ax.set_yscale("log")

        g.set_axis_labels(r"Time $t$", r"Error")
        g.set_titles(
            row_template=rf"${param_name}$={{row_name}}", col_template=r"$c$={col_name}"
        )

        param_display = "L" if param_name == "L" else "N"
        fixed_param = "N=128" if param_name == "L" else "L=30"
        g.fig.suptitle(
            f"{method} - {investigation_type.capitalize()} Investigation: Errors (varying {param_display}, {fixed_param})",
            y=1.02,
        )

        return g.fig


    def plot_conservation(df_quantities, method, investigation_type, param_name):
        """Create conservation relative error plot using FacetGrid.

        Parameters
        ----------
        df_quantities : DataFrame
            Quantity data (already in long format)
        method : str
            Method name (RK4, RK3)
        investigation_type : str
            'domain' or 'nodes'
        param_name : str
            'L' for domain, 'N' for nodes
        """
        # Filter for this method
        df_cons = df_quantities[df_quantities["method"] == method].copy()

        # Create relplot with param_name in rows, c in columns
        g = sns.relplot(
            data=df_cons,
            x="t",
            y="rel_error",
            hue="quantity",
            row=param_name,
            col="c",
            kind="line",
            height=3.5,
            aspect=1.3,
            facet_kws={"sharex": True, "sharey": False},
        )

        # Add horizontal line at y=0
        for ax in g.axes.flat:
            ax.axhline(y=0, color="gray", linestyle="--", linewidth=0.5, alpha=0.5)

        g.set_axis_labels(r"Time $t$", r"Relative error")
        g.set_titles(
            row_template=rf"${param_name}$={{row_name}}", col_template=r"$c$={col_name}"
        )

        param_display = "L" if param_name == "L" else "N"
        fixed_param = "N=128" if param_name == "L" else "L=30"
        g.fig.suptitle(
            f"{method} - {investigation_type.capitalize()} Investigation: Conservation (varying {param_display}, {fixed_param})",
            y=1.02,
        )

        return g.fig


    def plot_quantities(df_quantities, method, investigation_type, param_name):
        """Create actual conservation quantities plot using FacetGrid.

        Parameters
        ----------
        df_quantities : DataFrame
            Quantity data (already in long format)
        method : str
            Method name (RK4, RK3)
        investigation_type : str
            'domain' or 'nodes'
        param_name : str
            'L' for domain, 'N' for nodes
        """
        # Filter for this method
        df_qty = df_quantities[df_quantities["method"] == method].copy()

        # Create relplot with param_name in rows, c in columns
        g = sns.relplot(
            data=df_qty,
            x="t",
            y="value",
            hue="quantity",
            row=param_name,
            col="c",
            kind="line",
            height=3.5,
            aspect=1.3,
            facet_kws={"sharex": True, "sharey": False},
        )

        g.set_axis_labels(r"Time $t$", r"Value")
        g.set_titles(
            row_template=rf"${param_name}$={{row_name}}", col_template=r"$c$={col_name}"
        )

        param_display = "L" if param_name == "L" else "N"
        fixed_param = "N=128" if param_name == "L" else "L=30"
        g.fig.suptitle(
            f"{method} - {investigation_type.capitalize()} Investigation: Quantities M, V, E (varying {param_display}, {fixed_param})",
            y=1.02,
        )

        return g.fig









.. GENERATED FROM PYTHON SOURCE LINES 197-263

.. code-block:: Python

    print("\nCreating plots...")

    methods = sorted(df_domain_errors["method"].unique())

    for method in methods:
        print(f"\n{method}:")

        # Domain investigation - errors
        fig = plot_errors(df_domain_errors, method, "domain", "L")
        df_method_domain = df_domain_errors[df_domain_errors["method"] == method]
        L_vals = sorted(df_method_domain["L"].unique())
        add_parameter_footer(
            fig, rf"$N = 128$, $L \in [{L_vals[0]:.1f}, {L_vals[-1]:.1f}]$, $T = 20$"
        )
        output = save_dir / f"{method.lower()}_domain_errors.pdf"
        fig.savefig(output, bbox_inches="tight")
        print(f"  Saved: {output}")

        # Domain investigation - conservation (relative errors)
        fig = plot_conservation(df_domain_quantities, method, "domain", "L")
        add_parameter_footer(
            fig, rf"$N = 128$, $L \in [{L_vals[0]:.1f}, {L_vals[-1]:.1f}]$, $T = 20$"
        )
        output = save_dir / f"{method.lower()}_domain_conservation.pdf"
        fig.savefig(output, bbox_inches="tight")
        print(f"  Saved: {output}")

        # Domain investigation - quantities (actual values)
        fig = plot_quantities(df_domain_quantities, method, "domain", "L")
        add_parameter_footer(
            fig, rf"$N = 128$, $L \in [{L_vals[0]:.1f}, {L_vals[-1]:.1f}]$, $T = 20$"
        )
        output = save_dir / f"{method.lower()}_domain_quantities.pdf"
        fig.savefig(output, bbox_inches="tight")
        print(f"  Saved: {output}")

        # Node investigation - errors
        fig = plot_errors(df_nodes_errors, method, "nodes", "N")
        df_method_nodes = df_nodes_errors[df_nodes_errors["method"] == method]
        N_vals = sorted(df_method_nodes["N"].unique())
        add_parameter_footer(
            fig, rf"$L = 30.0$, $N \in [{N_vals[0]}, {N_vals[-1]}]$, $T = 20$"
        )
        output = save_dir / f"{method.lower()}_nodes_errors.pdf"
        fig.savefig(output, bbox_inches="tight")
        print(f"  Saved: {output}")

        # Node investigation - conservation (relative errors)
        fig = plot_conservation(df_nodes_quantities, method, "nodes", "N")
        add_parameter_footer(
            fig, rf"$L = 30.0$, $N \in [{N_vals[0]}, {N_vals[-1]}]$, $T = 20$"
        )
        output = save_dir / f"{method.lower()}_nodes_conservation.pdf"
        fig.savefig(output, bbox_inches="tight")
        print(f"  Saved: {output}")

        # Node investigation - quantities (actual values)
        fig = plot_quantities(df_nodes_quantities, method, "nodes", "N")
        add_parameter_footer(
            fig, rf"$L = 30.0$, $N \in [{N_vals[0]}, {N_vals[-1]}]$, $T = 20$"
        )
        output = save_dir / f"{method.lower()}_nodes_quantities.pdf"
        fig.savefig(output, bbox_inches="tight")
        print(f"  Saved: {output}")

    print("\nAll plots created!")



.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_001.png
         :alt: RK3 - Domain Investigation: Errors (varying L, N=128), $L$=20.0 | $c$=0.25, $L$=20.0 | $c$=0.5, $L$=20.0 | $c$=1.0, $L$=30.0 | $c$=0.25, $L$=30.0 | $c$=0.5, $L$=30.0 | $c$=1.0, $L$=40.0 | $c$=0.25, $L$=40.0 | $c$=0.5, $L$=40.0 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_001.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_002.png
         :alt: RK3 - Domain Investigation: Conservation (varying L, N=128), $L$=20.0 | $c$=0.25, $L$=20.0 | $c$=0.5, $L$=20.0 | $c$=1.0, $L$=30.0 | $c$=0.25, $L$=30.0 | $c$=0.5, $L$=30.0 | $c$=1.0, $L$=40.0 | $c$=0.25, $L$=40.0 | $c$=0.5, $L$=40.0 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_002.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_003.png
         :alt: RK3 - Domain Investigation: Quantities M, V, E (varying L, N=128), $L$=20.0 | $c$=0.25, $L$=20.0 | $c$=0.5, $L$=20.0 | $c$=1.0, $L$=30.0 | $c$=0.25, $L$=30.0 | $c$=0.5, $L$=30.0 | $c$=1.0, $L$=40.0 | $c$=0.25, $L$=40.0 | $c$=0.5, $L$=40.0 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_003.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_004.png
         :alt: RK3 - Nodes Investigation: Errors (varying N, L=30), $N$=32 | $c$=0.25, $N$=32 | $c$=0.5, $N$=32 | $c$=1.0, $N$=64 | $c$=0.25, $N$=64 | $c$=0.5, $N$=64 | $c$=1.0, $N$=128 | $c$=0.25, $N$=128 | $c$=0.5, $N$=128 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_004.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_005.png
         :alt: RK3 - Nodes Investigation: Conservation (varying N, L=30), $N$=32 | $c$=0.25, $N$=32 | $c$=0.5, $N$=32 | $c$=1.0, $N$=64 | $c$=0.25, $N$=64 | $c$=0.5, $N$=64 | $c$=1.0, $N$=128 | $c$=0.25, $N$=128 | $c$=0.5, $N$=128 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_005.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_006.png
         :alt: RK3 - Nodes Investigation: Quantities M, V, E (varying N, L=30), $N$=32 | $c$=0.25, $N$=32 | $c$=0.5, $N$=32 | $c$=1.0, $N$=64 | $c$=0.25, $N$=64 | $c$=0.5, $N$=64 | $c$=1.0, $N$=128 | $c$=0.25, $N$=128 | $c$=0.5, $N$=128 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_006.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_007.png
         :alt: RK4 - Domain Investigation: Errors (varying L, N=128), $L$=20.0 | $c$=0.25, $L$=20.0 | $c$=0.5, $L$=20.0 | $c$=1.0, $L$=30.0 | $c$=0.25, $L$=30.0 | $c$=0.5, $L$=30.0 | $c$=1.0, $L$=40.0 | $c$=0.25, $L$=40.0 | $c$=0.5, $L$=40.0 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_007.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_008.png
         :alt: RK4 - Domain Investigation: Conservation (varying L, N=128), $L$=20.0 | $c$=0.25, $L$=20.0 | $c$=0.5, $L$=20.0 | $c$=1.0, $L$=30.0 | $c$=0.25, $L$=30.0 | $c$=0.5, $L$=30.0 | $c$=1.0, $L$=40.0 | $c$=0.25, $L$=40.0 | $c$=0.5, $L$=40.0 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_008.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_009.png
         :alt: RK4 - Domain Investigation: Quantities M, V, E (varying L, N=128), $L$=20.0 | $c$=0.25, $L$=20.0 | $c$=0.5, $L$=20.0 | $c$=1.0, $L$=30.0 | $c$=0.25, $L$=30.0 | $c$=0.5, $L$=30.0 | $c$=1.0, $L$=40.0 | $c$=0.25, $L$=40.0 | $c$=0.5, $L$=40.0 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_009.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_010.png
         :alt: RK4 - Nodes Investigation: Errors (varying N, L=30), $N$=32 | $c$=0.25, $N$=32 | $c$=0.5, $N$=32 | $c$=1.0, $N$=64 | $c$=0.25, $N$=64 | $c$=0.5, $N$=64 | $c$=1.0, $N$=128 | $c$=0.25, $N$=128 | $c$=0.5, $N$=128 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_010.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_011.png
         :alt: RK4 - Nodes Investigation: Conservation (varying N, L=30), $N$=32 | $c$=0.25, $N$=32 | $c$=0.5, $N$=32 | $c$=1.0, $N$=64 | $c$=0.25, $N$=64 | $c$=0.5, $N$=64 | $c$=1.0, $N$=128 | $c$=0.25, $N$=128 | $c$=0.5, $N$=128 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_011.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_012.png
         :alt: RK4 - Nodes Investigation: Quantities M, V, E (varying N, L=30), $N$=32 | $c$=0.25, $N$=32 | $c$=0.5, $N$=32 | $c$=1.0, $N$=64 | $c$=0.25, $N$=64 | $c$=0.5, $N$=64 | $c$=1.0, $N$=128 | $c$=0.25, $N$=128 | $c$=0.5, $N$=128 | $c$=1.0
         :srcset: /exercise_gallery/exercise_d/images/sphx_glr_plot_ex_d_012.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Creating plots...

    RK3:
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk3_domain_errors.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk3_domain_conservation.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk3_domain_quantities.pdf
    /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/Exercises/exercise_d/plot_ex_d.py:83: UserWarning: Data has no positive values, and therefore cannot be log-scaled.
      ax.set_yscale("log")
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk3_nodes_errors.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk3_nodes_conservation.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk3_nodes_quantities.pdf

    RK4:
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk4_domain_errors.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk4_domain_conservation.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk4_domain_quantities.pdf
    /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/Exercises/exercise_d/plot_ex_d.py:83: UserWarning: Data has no positive values, and therefore cannot be log-scaled.
      ax.set_yscale("log")
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk4_nodes_errors.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk4_nodes_conservation.pdf
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_d/rk4_nodes_quantities.pdf

    All plots created!





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 11.692 seconds)


.. _sphx_glr_download_exercise_gallery_exercise_d_plot_ex_d.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_ex_d.ipynb <plot_ex_d.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_ex_d.py <plot_ex_d.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_ex_d.zip <plot_ex_d.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
