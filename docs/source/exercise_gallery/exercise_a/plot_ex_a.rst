
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "exercise_gallery/exercise_a/plot_ex_a.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_exercise_gallery_exercise_a_plot_ex_a.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_exercise_gallery_exercise_a_plot_ex_a.py:


Legendre Tau vs Collocation - Plotting
=======================================

Visualizes solution comparisons and coefficient decay for Legendre Tau and
Collocation methods across different boundary layer widths.

.. GENERATED FROM PYTHON SOURCE LINES 10-13

Load and prepare data
---------------------
Load the precomputed solutions and coefficient data from both methods.

.. GENERATED FROM PYTHON SOURCE LINES 13-30

.. code-block:: Python


    import numpy as np
    import pandas as pd
    import seaborn as sns

    from spectral.utils.plotting import add_parameter_footer, get_repo_root

    repo_root = get_repo_root()
    data_dir = repo_root / "data/A2/ex_a"
    save_dir = repo_root / "figures/A2/ex_a"
    save_dir.mkdir(parents=True, exist_ok=True)

    df = pd.read_parquet(data_dir / "data.parquet")
    print(f"Loaded unified data: {df.shape}")

    df_sol = df[df["data_type"] == "solution"].copy()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Loaded unified data: (18459, 12)




.. GENERATED FROM PYTHON SOURCE LINES 31-34

Solution comparison
-------------------
Compare Tau and Collocation solutions across different boundary layer widths.

.. GENERATED FROM PYTHON SOURCE LINES 34-62

.. code-block:: Python


    N = df_sol["N"].iloc[0]
    n_eval_points = df_sol["x"].nunique()

    g = sns.relplot(
        data=df_sol,
        x="x",
        y="u",
        hue="method",
        style="method",
        kind="line",
        col="eps",
        col_wrap=3,
        facet_kws=dict(sharey=False, sharex=True),
        height=4,
        aspect=1.2,
    )
    g.set_titles(r"$\varepsilon={col_name:g}$")
    g.set_axis_labels(r"$x$", r"$u(x)$")
    g.figure.suptitle(r"Tau vs Collocation for different $\varepsilon$", y=1.02)

    # Add parameter footer
    add_parameter_footer(g.figure, rf"$N = {N}$ ({n_eval_points} Evaluation points)")

    output = save_dir / "solutions_facet.pdf"
    g.figure.savefig(output, bbox_inches="tight")
    print(f"  Saved: {output}")




.. image-sg:: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_001.png
   :alt: Tau vs Collocation for different $\varepsilon$, $\varepsilon=0.001$, $\varepsilon=0.01$, $\varepsilon=0.1$
   :srcset: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_a/solutions_facet.pdf




.. GENERATED FROM PYTHON SOURCE LINES 63-66

Coefficient decay
-----------------
Visualize how Legendre coefficients decay for both methods.

.. GENERATED FROM PYTHON SOURCE LINES 66-100

.. code-block:: Python


    df_coef = df[df["data_type"] == "coefficient"]
    df_coef2 = df_coef[df_coef["method"] != "Exact"]

    # Filter out mode 0 for log scale
    df_coef_plot = df_coef2[df_coef2["mode"] > 0].copy()
    df_coef_plot["method"] = df_coef_plot["method"].cat.remove_unused_categories()


    g2 = sns.relplot(
        data=df_coef_plot,
        x="mode",
        y="abs_coeff",
        hue="method",
        style="method",
        kind="line",
        col="eps",
        col_wrap=3,
        marker="o",
        dashes=False,
        height=4,
        aspect=1.2,
    )
    g2.set(xscale="log", yscale="log", xlabel=r"Legendre mode $n$", ylabel=r"$|c_n|$")
    g2.set_titles(r"$\varepsilon={col_name:g}$")
    g2.figure.suptitle("Coefficient Decay: Tau vs Collocation", y=1.02)

    # Add parameter footer
    add_parameter_footer(g2.figure, rf"$N = {N}$ ({n_eval_points} Evaluation points)")

    output = save_dir / "coefficients_facet.pdf"
    g2.figure.savefig(output, bbox_inches="tight")
    print(f"  Saved: {output}")




.. image-sg:: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_002.png
   :alt: Coefficient Decay: Tau vs Collocation, $\varepsilon=0.001$, $\varepsilon=0.01$, $\varepsilon=0.1$
   :srcset: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_a/coefficients_facet.pdf




.. GENERATED FROM PYTHON SOURCE LINES 101-104

Error profiles
--------------
Show pointwise error distributions for both methods.

.. GENERATED FROM PYTHON SOURCE LINES 104-133

.. code-block:: Python


    print("\nCreating error profiles...")
    df_sol = df_sol[df_sol["method"] != "Exact"]
    df_sol["method"] = df_sol["method"].cat.remove_unused_categories()

    g3 = sns.relplot(
        data=df_sol,
        x="x",
        y="pointwise_err",
        hue="method",
        style="method",
        kind="line",
        col="eps",
        col_wrap=3,
        facet_kws=dict(sharey=False),
        height=4,
        aspect=1.2,
    )
    g3.set(yscale="log", xlabel=r"$x$", ylabel=r"$|u_{\rm num}-u_{\rm exact}|$")
    g3.set_titles(r"$\varepsilon={col_name:g}$")
    g3.figure.suptitle("Error Profiles: Tau vs Collocation", y=1.02)

    # Add parameter footer
    add_parameter_footer(g3.figure, rf"$N = {N}$ ({n_eval_points} Evaluation points)")

    output = save_dir / "errors_facet.pdf"
    g3.figure.savefig(output, bbox_inches="tight")
    print(f"  Saved: {output}")




.. image-sg:: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_003.png
   :alt: Error Profiles: Tau vs Collocation, $\varepsilon=0.001$, $\varepsilon=0.01$, $\varepsilon=0.1$
   :srcset: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Creating error profiles...
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_a/errors_facet.pdf




.. GENERATED FROM PYTHON SOURCE LINES 134-137

Convergence study
-----------------
Analyze how error decreases with increasing number of modes.

.. GENERATED FROM PYTHON SOURCE LINES 137-193

.. code-block:: Python


    print("\nCreating convergence plots...")
    convergence_df = pd.read_parquet(data_dir / "convergence.parquet")

    # Create faceted convergence plot
    g4 = sns.relplot(
        data=convergence_df,
        x="N",
        y="Linf_err",
        hue="method",
        style="method",
        kind="line",
        col="eps",
        col_wrap=3,
        marker="o",
        facet_kws=dict(sharey=False),
        height=4,
        aspect=1.2,
    )
    g4.set(
        xscale="log",
        yscale="log",
        xlabel=r"Number of modes $N$",
        ylabel=r"$L^\infty$ Error",
    )
    g4.set_titles(r"$\varepsilon={col_name:g}$")
    g4.figure.suptitle("Convergence Study: Tau vs Collocation", y=1.02)

    # Add reference lines to each subplot
    for ax, (eps_val, group) in zip(
        g4.axes.flat, convergence_df.groupby("eps", observed=True)
    ):
        N_vals = group["N"].unique()
        N_ref = np.array([N_vals.min(), N_vals.max()])

        # O(N^-2) reference line
        slope = -2
        err_ref_start = group[group["N"] == N_vals.min()]["Linf_err"].max()
        err_ref = err_ref_start * (N_ref / N_vals.min()) ** slope

        ax.plot(
            N_ref, err_ref, "k--", alpha=0.5, linewidth=1.5, label=r"$\mathcal{O}(N^{-2})$"
        )
        ax.legend()

    # Add parameter footer (N range varies for convergence study)
    N_min = convergence_df["N"].min()
    N_max = convergence_df["N"].max()
    # Note: convergence data doesn't have x values, use main data for eval points
    add_parameter_footer(
        g4.figure, rf"$N \in [{N_min}, {N_max}]$ ({n_eval_points} Evaluation points)"
    )

    output = save_dir / "convergence_facet.pdf"
    g4.figure.savefig(output, bbox_inches="tight")
    print(f"  Saved: {output}")



.. image-sg:: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_004.png
   :alt: Convergence Study: Tau vs Collocation, $\varepsilon=0.001$, $\varepsilon=0.01$, $\varepsilon=0.1$
   :srcset: /exercise_gallery/exercise_a/images/sphx_glr_plot_ex_a_004.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Creating convergence plots...
      Saved: /Users/philipnickel/Documents/GitHub/DTU_Courses/advNumAlg/MainRepo/figures/A2/ex_a/convergence_facet.pdf





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 2.478 seconds)


.. _sphx_glr_download_exercise_gallery_exercise_a_plot_ex_a.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_ex_a.ipynb <plot_ex_a.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_ex_a.py <plot_ex_a.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_ex_a.zip <plot_ex_a.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
